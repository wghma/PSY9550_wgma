---
title: "PSY9550_chp3_wgma"
author: "team name"
date: 02-19-2024     # Obs! American date format
format:
  html:
    toc: true
    toc-location: left
    embed-resources: true
    page-layout: full
    html-math-method: katex
editor: source
---

```{css, echo = F}
body{
  font-family: Helvetica;
  font-size: 16pt;
  max-width: 1000px;
  margin: auto;
  margin-left:310px;
}
pre{
  font-size: 14px;
}
/* Headers */
h1{
    font-size: 24pt;
  }
h1,h2{
    font-size: 20pt;
  }
h3,h4,h5,h6{
  font-size: 18pt;
}
#TOC {
  position: fixed;
  left: 0;
  top: 0;
  width: 300px;
  height: 100%;
  overflow:auto;
}
```

```{r setup,}
#| include: false
#| message: false
#| warning: false
#| results: hide
knitr::opts_chunk$set(echo = TRUE, dpi = 300)

library(rethinking)
library(magrittr)
library(tidyverse)

# add other packages you use here
```

# Chapter 3 (all easy exercises)

```{r}

p_grid <- seq( from=0 , to=1 , length.out=1000 ) 
prior <- rep( 1 , 1000 ) 
likelihood <- dbinom( 6 , size=9 , prob=p_grid ) 
posterior <- likelihood * prior 
posterior <- posterior / sum(posterior) 

set.seed(100) 
n_samples = 1e4 
samples <- sample( p_grid , prob=posterior , size=n_samples , replace=TRUE )

samples[1:10]
```

```{r}
plot(samples)
```

## 3E1. samples below p=0.2

```{r}
sum(samples < 0.2)/n_samples
# mean(samples < 0.2)
```

## 3E2. samples above p = 0.8?

```{r}
sum(samples > 0.8)/n_samples

```

## 3E3. samples between p = 0.2 and p = 0.8

How much posterior probability lies between p = 0.2 and p = 0.8?

```{r}
sum(samples > 0.2 & samples < 0.8)/n_samples

#note to self: mean(between(samples, 0.2, 0.8))
```

## 3E4. prob mass 20% below which p

20% of the posterior probability lies below which value of p?

```{r}

quantile (samples, 0.2)

```

## 3E5. prob mass 20% above which p

20% of the posterior probability lies above which value of p?

```{r}
quantile(samples, 0.8)

```

## 3E6. Narrowest interval with prob mass = 66%

Which values of p contain the narrowest interval equal to 66% of the posterior probability?

```{r}

HPDI( samples , prob=0.66 )

```

## 3E7. assume equal prob mass each side of interval of prob mass 66%

Which values of p contain 66% of the posterior probability, assuming equal posterior probability both below and above the interval? Equal posterior probability on both sides of the interval means the middle p of the interval is the median. there are 34%/2 = 17% on each side. Check for p at prob mass 17% and 83% (100-17).

```{r}
# lower p 
quantile(samples, 0.17)

```

```{r}
# high p
quantile(samples, 0.83)

# or: PI(samples, prob = 0.66)
```

# Chapter 3 (M1-M5)

## 3M1. W=8, N =15

Suppose the globe tossing data had turned out to be 8 water in 15 tosses. Construct the posterior distribution, using grid approximation. Use the same flat prior as before.

```{r}

grid_size = 1000

p_grid <- seq( from=0 , to=1 , length.out=grid_size ) 
prior <- rep( 1 , grid_size ) 
likelihood <- dbinom( 8 , size=15 , prob=p_grid ) 

posterior_uni <- likelihood * prior 
posterior_uni <- posterior_uni / sum(posterior_uni) 

```

```{r, warning = F}
plot( p_grid , posterior_uni , 
      type="b" , 
      xlab="probability of water" , 
      ylab="posterior probability" ) 
mtext( "1000 points. Data: 8 water of 15 tosses" )
```

## 3M2. grid_size = 10000

Draw 10,000 samples from the grid approximation from above. Then use the samples to calculate the 90% HPDI for p.

```{r}

#posterior_uni

set.seed(57) 
n_samples = 1e4 
samples_uni <- sample( p_grid , prob=posterior_uni , size=n_samples , replace=TRUE )
HPDI( samples_uni , prob=0.9 )
```

## 3M3. 8/15 posterior -\> samples , p for 8/15

Construct a posterior predictive check for this model and data. This means simulate the distribution of samples, averaging over the posterior uncertainty in p. What is the probability of observing 8 water in 15 tosses?

```{r}
#posterior_uni
#sample_uni
set.seed(57) 
n=15

n_simulations = 1e4
simulated_data_uni <-  rbinom( n_simulations , size=n , prob=samples )
simulated_data_uni[1:10]

```

The probability of observing 8 water out of 15 tosses from the simulated data is 15%.

```{r}

table(simulated_data_uni)/n_simulations

```

## 3M4. posterior 8/15, p for 6/9

Using the posterior distribution constructed from the new (8/15) data, now calculate the probability of observing 6 water in 9 tosses.

```{r}

n_simulations = 1e4
simulated_data_uni <-  rbinom( n_simulations , size=9 , prob=samples )
simulated_data_uni[1:10]

```

The probability of observing 6 water out of 9 tosses from the simulated data is 20.0%.

```{r}

table(simulated_data_uni)/n_simulations

```

## 3M5.

Start over at 3M1, but now use a prior that is zero below p = 0.5 and a constant above p = 0.5. This corresponds to prior information that a majority of the Earthâ€™s surface is water. Repeat each problem above and compare the inferences. What difference does the better prior make? If it helps, compare inferences (using both priors) to the true value p = 0.7.

```{r}

grid_size = 1000
w = 8
n = 15

p_grid <- seq( from=0 , to=1 , length.out=grid_size ) 
prior <- prior <- 1*(p_grid>= 0.5) 
likelihood <- dbinom( w , size=n , prob=p_grid ) 

# dich = dichotomous
posterior_dich <- likelihood * prior 
posterior_dich <- posterior_dich / sum(posterior_dich) 

```

```{r, warning = F}
plot( p_grid , posterior_dich , 
      type="b" , 
      xlab="probability of water" , 
      ylab="posterior probability" ) 
mtext( "1000 points. Data: 8 water of 15 tosses. prior 0 and 1 at p=0.5" )
```

The 90% HPDI for p.(3M2)

```{r}
set.seed(57) 
n_samples = 1e4 
samples_dich <- sample( p_grid , prob=posterior_dich , size=n_samples , replace=TRUE )
HPDI( samples_dich , prob=0.9 )
```

(3M3) The probability of observing 8 water out of 15 tosses from the simulated data is 15.8%. A uniform prior gave us 15.0% earlier.

```{r}
n_simulations = 1e4
simulated_data_dich <-  rbinom( n_simulations , size=15 , prob=samples_dich )
# simulated_data[1:10]
table(simulated_data_dich)/n_simulations

# or: mean(simulated_data_dich == 8)
```

(3M4) The probability of observing 6 water out of 9 tosses from the simulated data is 19.9%. For an uniform prior the probability was 20.0%.

```{r}
n_simulations = 1e4
simulated_data_dich <-  rbinom( n_simulations , size=9 , prob=samples )
# simulated_data[1:10]
table(simulated_data_dich)/n_simulations
```

Comparing distribution of simulated samples for two priors: uniform and dichotomous at p=0.5. We also compare it to the simulated distribution assuming p=0.7 as true value.

```{r}
simulated_data_real <-  rbinom( n_simulations , size=9 , prob=0.7 )
```

When plotting the distributions of the simulated data, the two distributions based on data 8 water out of 15 tosses seem to have almost identical overlapping distributions (even when they have different priors).

```{r}
# library(tidyverse)
data.frame(prior=prior, 
           uni = simulated_data_uni,
           dich=simulated_data_dich, 
           real=simulated_data_real) %>% 
tibble() %>% 
pivot_longer(!prior, names_to = "sim", values_to = "value") %>% 

ggplot(aes(x=value, fill=sim, color =sim))+
  geom_density(bw = 1, alpha = 0.5)+
# geom_histogram(alpha=0.7, position = "identity")+
  scale_x_continuous(breaks = seq(1,12,1) )


```


# Clarification and or discussion questions

How can the 99% -intervals be so different in width, but look so alike when plotting density distributions?

```{r}
HPDI(samples_uni, prob = 0.9)

```
```{r}

HPDI(samples_dich, prob = 0.9)
```
